<template>
	<lightning-card title="Create a New Survey" icon-name="standard:survey">
		<!-- Loading State -->
		<template if:true={isLoading}>
			<div class="slds-is-relative" style="min-height: 200px">
				<lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
			</div>
		</template>

		<!-- Main Content -->
		<template if:false={isLoading}>
			<div class="slds-m-around_medium">
				<!-- Site Warning -->
				<template if:false={hasExistingSite}>
					<div class="slds-notify slds-notify_alert slds-alert_warning slds-m-bottom_medium" role="alert">
						<lightning-icon icon-name="utility:warning" size="small" class="slds-m-right_x-small"></lightning-icon>
						<span class="slds-assistive-text">warning</span>
						<h2>{siteWarningMessage}</h2>
					</div>
				</template>

				<!-- Survey Creation Form -->
				<div class="slds-box slds-theme_default">
					<h3 class="slds-text-heading_small slds-m-bottom_medium">Make a New Survey</h3>

					<lightning-input
						label="Survey Name"
						value={surveyName}
						onchange={handleNameChange}
						required
						disabled={isCreating}
						placeholder="Enter survey name"
						class="slds-m-bottom_medium"></lightning-input>

					<lightning-button variant="brand" label="Create New Survey" onclick={handleCreateSurvey} disabled={isCreating} class="slds-m-top_small"></lightning-button>
				</div>

				<!-- Recent Surveys -->
				<template if:true={showRecentSurveys}>
					<div class="slds-box slds-theme_shade slds-m-top_medium">
						<h3 class="slds-text-heading_small slds-m-bottom_medium">Recent Surveys</h3>

						<table class="slds-table slds-table_cell-buffer slds-table_bordered">
							<thead>
								<tr class="slds-line-height_reset">
									<th class="slds-text-heading_label" scope="col">
										<div class="slds-truncate" title="Survey Name">Survey Name</div>
									</th>
									<th class="slds-text-heading_label" scope="col">
										<div class="slds-truncate" title="Questions">Questions</div>
									</th>
									<th class="slds-text-heading_label" scope="col">
										<div class="slds-truncate" title="Responses">Responses</div>
									</th>
									<th class="slds-text-heading_label" scope="col">
										<div class="slds-truncate" title="Actions">Actions</div>
									</th>
								</tr>
							</thead>
							<tbody>
								<template for:each={recentSurveys} for:item="survey">
									<tr key={survey.Id} class="slds-hint-parent">
										<td data-label="Survey Name">
											<div class="slds-truncate" title={survey.Name}>{survey.Name}</div>
										</td>
										<td data-label="Questions">
											<div class="slds-truncate">{survey.Questions__c}</div>
										</td>
										<td data-label="Responses">
											<div class="slds-truncate">{survey.Completed_Surveys__c}</div>
										</td>
										<td data-label="Actions">
											<lightning-button variant="base" label="View" data-survey-id={survey.Id} onclick={handleViewSurvey}></lightning-button>
										</td>
									</tr>
								</template>
							</tbody>
						</table>
					</div>
				</template>
			</div>
		</template>
	</lightning-card>
</template>
